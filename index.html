<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test Connexion Gmail</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    #authorize_button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <button id="authorize_button">Se connecter à Gmail</button>
  <div id="status"></div>

  <script>
    const CLIENT_ID = '454242049005-78upa3iiobs9nu72avo3m5aeri7ptt7g.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBnoXIDbrGoBJorZQWx1gT1XFHlWU-3oio';
    const SCOPES = 'https://www.googleapis.com/auth/gmail.send';

    const authorizeButton = document.getElementById('authorize_button');
    const statusDiv = document.getElementById('status');

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],
        scope: SCOPES
      }).then(() => {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

        authorizeButton.onclick = () => gapi.auth2.getAuthInstance().signIn();
      }, (error) => {
        console.error(error);
        statusDiv.textContent = 'Erreur initialisation Google API';
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        statusDiv.textContent = 'Connecté à Gmail.';
      } else {
        statusDiv.textContent = 'Non connecté.';
      }
    }

    window.onload = handleClientLoad;
  </script>
</body>
</html>
